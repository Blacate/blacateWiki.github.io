<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Neail">
    <meta name="description" content="NeailWiki island">
    <title>
                Nginx - NeailWiki            </title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon" />
    <link href="/assets/semantic.min.css" rel="stylesheet"/>
    <link href="/assets/style.css" rel="stylesheet"/>
    <!-- <script src="/assets/semantic.min.js"></script> -->
    <script src="/assets/highlight.min.js"></script>
    <base target="_blank">
</head>
<body>
<div style="margin-bottom: 80px;">
    <div class="ui container">
        <div class="ui dividing header">
            <h1 class="heading">
                <a href="/" class="logo-text" target="_self">
                    NeailWiki                </a>
            </h1>
            <small>Because Change Happens.</small>
        </div>
<div class="ui stackable grid">
<div id="detailInfo" class="twelve wide column">
<div class="column">
<div class="ui raised segment">
<a class="ui blue ribbon label">Web Server</a>
<h1 class="page-title">Nginx</h1>
<div class="page-content">
<h4><a href="#Default_Configuration" name="Default_Configuration" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Default Configuration</h4>
<pre><code class="language-nginx">server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /usr/share/nginx/html;
    idnex index.html index.htm index.nginx-debian.html;
    server_name _;

    location / {
        try_files $uri/ =404;
    }

    location /.git {
        deny all;
    }
}
</code></pre>
<h4><a href="#Http_To_Https_Configuration" name="Http_To_Https_Configuration" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Http To Https Configuration</h4>
<pre><code class="language-nginx">server {
    listen 80;
    server_name www.example.com;

    location /.well-known {
        default_type &quot;text/plain&quot;;
        root /usr/share/nginx/html; 
    }

    location / {
        return 301 https://$host$request_uri;
    }
}
</code></pre>
<p>with default configuration and http to https configuration,<br />
we can use letsencrypt to get certs for any domain which resolve to this host.</p>
<h4><a href="#Simple_Directory_Index_configuration" name="Simple_Directory_Index_configuration" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Simple Directory Index configuration</h4>
<pre><code class="language-nginx">server {
    listen 80;
    server_name www.example.com;
    root /var/www/html;
    access_log /var/log/nginx/example.access.log;
    error_log /var/log/nginx/example.error.log;

    location / {
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;
        charset utf-8;
    }
}
</code></pre>
<h4><a href="#ReverseProxy" name="ReverseProxy" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;ReverseProxy</h4>
<pre><code class="language-nginx">server {
    listen 80;
    server_name new-site.com;

    location / {
        proxy_pass http://origin-site.com/;
        proxy_redirect default;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forward-IP $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        port_in_redirect    on;
        server_name_in_redirect off;
        proxy_connect_timeout 300;
    }
}
</code></pre>
<h4><a href="#Nginx_with_ssl" name="Nginx_with_ssl" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Nginx with ssl</h4>
<p>Generate a stronger DHE parameter</p>
<pre><code class="language-bash">cd /etc/ssl/certs
openssl dhparam -out dhparam.pem 4096
</code></pre>
<p>then</p>
<pre><code class="language-nginx">server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name example.com;

    ssl on;
    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';
    keepalive_timeout    70;
    ssl_session_cache    shared:SSL:10m;
    ssl_session_timeout  10m;

    ssl_dhparam /etc/ssl/certs/dhparam.pem;

    add_header Strict-Transport-Security max-age=63072000;
    add_header X-Frame-Options SAMEORIGIN;
    add_header X-Content-Type-Options nosniff;

    access_log /var/log/nginx/example.access.log;
    error_log /var/log/nginx/example.error.log;

    root /opt/www/example.com;

    location /.git {
        deny all;
    }
}
</code></pre>
<h4><a href="#For_api_proxy" name="For_api_proxy" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;For api proxy</h4>
<pre><code class="language-nginx">location /api/ {
        proxy_pass http://hostname:port/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forward-IP $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        break;
    }

</code></pre>
<h4><a href="#Increase_HTTP_Post_Size_Limit" name="Increase_HTTP_Post_Size_Limit" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Increase HTTP Post Size Limit</h4>
<pre><code class="language-nginx">server {
    #...
    client_max_body_size 100m;
    #...
}
</code></pre>
<h4><a href="#Setup_Basic-Auth_on_NGINX" name="Setup_Basic-Auth_on_NGINX" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Setup Basic-Auth on NGINX</h4>
<p>Install <code>apache2-utils</code></p>
<pre><code class="language-shell">sudo apt-get install apache2-utils
</code></pre>
<p>Create User and password</p>
<pre><code class="language-shell">sudo htpasswd -c /etc/nginx/.htpasswd username
</code></pre>
<p>Add to Nginx site config</p>
<pre><code class="language-nginx">server {
    ...
    location / {
        ...
        auth_basic &quot;Restricted&quot;;
        auth_basic_user_file /etc/nginx/.htpasswd;  #For Basic Auth
    }
}
</code></pre>
<h4><a href="#CORS_Config" name="CORS_Config" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;CORS Config</h4>
<pre><code class="language-nginx">add_header 'Access-Control-Allow-Origin' &quot;www.example.com&quot;;
add_header 'Access-Control-Allow-Credentials' 'true';
add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS';
add_header 'Access-Control-Allow-Headers' 'Accept,Authorization,Cache-Control,Content-Type,DNT,If-Modified-Since,Keep-Alive,Origin,User-Agent,X-Mx-ReqToken,X-Requested-With'; 
</code></pre>
<h4><a href="#IP_Whitelist" name="IP_Whitelist" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;IP Whitelist</h4>
<pre><code class="language-nginx">location / {
    allow 1.1.1.1;  
    allow 192.168.1.0/24;  
    deny all; 
    ...
}
</code></pre>
<h4><a href="#My_IP" name="My_IP" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;My IP</h4>
<pre><code class="language-nginx">location /ip {
    default_type text/plain;
    return 200 &quot;$remote_addr\n&quot;;
}
</code></pre>
<h4><a href="#For_Vue_Use" name="For_Vue_Use" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;For Vue Use</h4>
<pre><code class="language-nginx">location / {
    try_files $uri $uri/ /index.html last;
}
</code></pre>
<h4><a href="#Websocket_Proxy" name="Websocket_Proxy" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Websocket Proxy</h4>
<pre><code class="language-nginx">location /wsapp/ {
    proxy_pass http://wsbackend;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;Upgrade&quot;;
}
</code></pre>
<h4><a href="#Multi_File_Backup" name="Multi_File_Backup" target="_self" class="anchor"><span class="header-link">#</span></a>&nbsp;Multi File Backup</h4>
<pre><code class="language-nginx">location / {
    root /path/to/file;
    try_files $uri $uri/ @backup;
}
location @backup {
    proxy_pass https://backup-server.com;
    proxy_set_header X-Real-IP  $remote_addr;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
</code></pre>
<p>Reference:</p>
<ul>
<li><p><a href="https://wiki.phoenixlzx.com/page/NGINX/">nginx-phoeixWiki</a></p></li>
<li><p><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-password-authentication-with-nginx-on-ubuntu-14-04">DigitalOcean Tutorials</a></p></li>
<li><p><a href="https://www.nginx.com/blog/websocket-nginx/">websocket-nginx</a></p></li>
</ul>
<p><em>Last Update: 2019-12-06 12:56:58</em> <a href="/raw/nginx.md">Source File</a></p>
</div>
<div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'NeailWiki';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>
</div>
</div>
</div>
<div class="four wide column">
<div class="column">
<div class="ui card" style="margin:0 auto">
    <div class="image">
        <img class="sidebar-avatar" src="/static/avatar.jpg">
    </div>
    <div class="content">
        <a class="header">Neail</a>
        <div class="meta">
            <span class="date">i@neail.xyz</span>
        </div>
        <div class="description">
            FE | Ailurophile | Open Source
        </div>
    </div>
    <div class="extra content" style="text-align: center">
        <a href="https://github.com/blacate" class="item">
            <i class="github icon large"></i>
        </a>
        <a href="https://plus.google.com/110495849647369930086" class="item">
            <i class="google icon large"></i>
        </a>
        <a href="https://twitter.com/blacate1" class="item">
            <i class="twitter icon large"></i>
        </a>
    </div>
</div><div id="subSidebar" class="ui vertical menu sidebar-column">
    <div class="item">
        <div class="header"><a href="/" target="_self">Homepage</a></div>
                <div class="header"><a href="/changelog/">Changelog</a></div>
            </div>
        <div class="item">
        <div class="header">OS X</div>
        <div class="menu">
                        <a href="/page/Homebrew/" target="_self" class="item">
                                Homebrew                            </a>
                        <a href="/page/Install Nginx/" target="_self" class="item">
                                Install Nginx                            </a>
                    </div>
    </div>
        <div class="item">
        <div class="header">CSS</div>
        <div class="menu">
                        <a href="/page/Horizontal-And-Vertical-Centering/" target="_self" class="item">
                                Horizontal And Vertical Centering                            </a>
                        <a href="/page/bfc/" target="_self" class="item">
                                BFC                            </a>
                        <a href="/page/css-Selectors/" target="_self" class="item">
                                CSS Selectors                            </a>
                        <a href="/page/css-animation/" target="_self" class="item">
                                CSS Animation                            </a>
                        <a href="/page/display/" target="_self" class="item">
                                Display                            </a>
                        <a href="/page/flex/" target="_self" class="item">
                                Flex                            </a>
                        <a href="/page/float/" target="_self" class="item">
                                Float                            </a>
                    </div>
    </div>
        <div class="item">
        <div class="header">JavaScript</div>
        <div class="menu">
                        <a href="/page/Inherit/" target="_self" class="item">
                                Inherit                            </a>
                        <a href="/page/ajax/" target="_self" class="item">
                                Ajax                            </a>
                    </div>
    </div>
        <div class="item">
        <div class="header">Tools</div>
        <div class="menu">
                        <a href="/page/git/" target="_self" class="item">
                                git                            </a>
                        <a href="/page/ssh/" target="_self" class="item">
                                ssh                            </a>
                    </div>
    </div>
        <div class="item">
        <div class="header">Security</div>
        <div class="menu">
                        <a href="/page/letsencrypt/" target="_self" class="item">
                                Let&#39;s Encrypt                            </a>
                    </div>
    </div>
        <div class="item">
        <div class="header">Algorithm</div>
        <div class="menu">
                        <a href="/page/linkedlist/" target="_self" class="item">
                                LinkedList                            </a>
                        <a href="/page/queue/" target="_self" class="item">
                                Queue                            </a>
                        <a href="/page/recursion/" target="_self" class="item">
                                Recursion                            </a>
                        <a href="/page/stack/" target="_self" class="item">
                                Stack                            </a>
                    </div>
    </div>
        <div class="item">
        <div class="header"></div>
        <div class="menu">
                        <a href="/page/markdown/" target="_self" class="item">
                                                            </a>
                    </div>
    </div>
        <div class="item">
        <div class="header">Web Server</div>
        <div class="menu">
                        <a href="/page/nginx/" target="_self" class="item">
                                Nginx                            </a>
                    </div>
    </div>
    </div>
</div>
</div>
</div>
    </div>
</div>
<div class="footer">
    <div class="footer-text">
        NeailWiki using <a href="https://github.com/phoenixlzx/MinoriWiki" target="_blank">MinoriWiki</a>
    </div>
</div>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>